!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],b):b(a.jQuery)}(this,function(a){"use strict";function t(a,b){return typeof a===b}function u(a,b){return!!~(""+a).indexOf(b)}function v(a,b){for(var c in a){var d=a[c];if(!u(d,"-")&&void 0!==k[d])return"pfx"==b?d:!0}return!1}function w(a,b,c){for(var d in a){var e=b[a[d]];if(void 0!==e)return c===!1?a[d]:t(e,"function")?e.bind(c||b):e}return!1}function x(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+m.join(d+" ")+d).split(" ");return t(b,"string")||t(b,"undefined")?v(e,b):(e=(a+" "+n.join(d+" ")+d).split(" "),w(e,b,c))}var b,r,c={image:null,imageAttribute:"image",holderClass:"imageHolder",imgClass:"img-holder-img",container:a("body"),windowObject:a(window),speed:.2,coverRatio:.75,holderMinHeight:200,holderMaxHeight:null,extraHeight:0,mediaWidth:1600,mediaHeight:900,parallax:!0,touch:!1},d="imageScroll",e="plugin_"+d,f=function(a,b){return function(){return a.apply(b,arguments)}},g={},h=document.documentElement,i="imageScrollModernizr",j=document.createElement(i),k=j.style,l="Webkit Moz O ms",m=l.split(" "),n=l.toLowerCase().split(" "),o={},p=0,q="",s=function(a,b,c,d){var e,f,g,j,k=document.createElement("div"),l=document.body,m=l||document.createElement("body");if(parseInt(c,10))for(;c--;)g=document.createElement("div"),g.id=d?d[c]:i+(c+1),k.appendChild(g);return e=["&#173;",'<style id="s',i,'">',a,"</style>"].join(""),k.id=i,(l?k:m).innerHTML+=e,m.appendChild(k),l||(m.style.background="",m.style.overflow="hidden",j=h.style.overflow,h.style.overflow="hidden",h.appendChild(m)),f=b(k,a),l?k.parentNode.removeChild(k):(m.parentNode.removeChild(m),h.style.overflow=j),!!f};return o.csstransforms=function(){return!!x("transform")},o.csstransforms3d=function(){var a=!!x("perspective");return a&&"webkitPerspective"in h.style&&s("@media (transform-3d),(-webkit-transform-3d){#imageScrollModernizr{left:9px;position:absolute;height:3px;}}",function(b){a=9===b.offsetLeft&&3===b.offsetHeight}),a},g.prefixed=function(a,b,c){return b?x(a,b,c):x(a,"pfx")},window.requestAnimationFrame=g.prefixed("requestAnimationFrame",window)||function(a){var c=(new Date).getTime(),d=Math.max(0,16-(c-p)),e=window.setTimeout(function(){a(c+d)},d);return p=c+d,e},o.csstransforms3d()?q="csstransforms3d":o.csstransforms()&&(q="csstransforms"),""!==q&&(r=g.prefixed("transform")),b=function(b,e){this.$imageHolder=a(b),this.settings=a.extend({},c,e),this.image=this.$imageHolder.data(this.settings.imageAttribute)||this.settings.image,this.mediaWidth=this.$imageHolder.data("width")||this.settings.mediaWidth,this.mediaHeight=this.$imageHolder.data("height")||this.settings.mediaHeight,this.coverRatio=this.$imageHolder.data("cover-ratio")||this.settings.coverRatio,this.holderMinHeight=this.$imageHolder.data("min-height")||this.settings.holderMinHeight,this.holderMaxHeight=this.$imageHolder.data("max-height")||this.settings.holderMaxHeight,this.extraHeight=this.$imageHolder.data("extra-height")||this.settings.extraHeight,this.ticking=!1,this.refresh=f(this.refresh,this),this._onScroll=f(this._onScroll,this),this._defaults=c,this._name=d,this.init()},a.extend(b.prototype,{constructor:b,init:function(){if(!this.image)throw new Error("You need to provide either a data-img attr or an image option");this.$scrollingElement=a("<img/>",{src:this.image}).addClass(this.settings.imgClass),this.settings.touch===!0?this.$scrollingElement.css({maxWidth:"100%"}).prependTo(this.$imageHolder):this.settings.parallax===!0?(this.$scrollerHolder=a("<div/>",{html:this.$imageHolder.html()}).css({top:0,visibility:"hidden",position:"fixed",overflow:"hidden"}).addClass(this.settings.holderClass).prependTo(this.settings.container),this.$imageHolder.css("visibility","hidden").empty(),this.$scrollingElement.css({position:"absolute",visibility:"hidden",maxWidth:"none"}).prependTo(this.$scrollerHolder)):(this.$scrollerHolder=this.$imageHolder.css({overflow:"hidden"}),this.$scrollingElement.css({position:"relative",overflow:"hidden"}).prependTo(this.$imageHolder)),this.settings.touch===!1&&(this._bindEvents(),this.refresh())},_adjustImgHolderHeights:function(){var d,e,f,g,h,i,j,k,l,a=this.settings.windowObject.height(),b=this.settings.windowObject.width()-2*this.settings.container.offset().left,c=this.coverRatio*a;c=null===this.holderMaxHeight||this.holderMaxHeight>c?Math.floor(c):this.holderMaxHeight,c=this.holderMinHeight<c?Math.floor(c):this.holderMinHeight,c+=this.extraHeight,k=Math.floor(a-(a-c)*this.settings.speed),i=Math.round(this.mediaWidth*(k/this.mediaHeight)),i>=b?j=k:(i=b,j=Math.round(this.mediaHeight*(i/this.mediaWidth))),l=k-c,h=a+c,g=2*a*(1-this.settings.speed)-l,d=-(l/2+(j-k)/2),e=Math.round((i-b)*-.5),f=d-g/2,this.$scrollingElement.css({height:j,width:i}),this.$imageHolder.height(c),this.$scrollerHolder.css({height:c,width:i}),this.scrollingState={winHeight:a,fromY:f,imgTopPos:d,imgLeftPos:e,imgHolderHeight:c,imgScrollingDistance:g,travelDistance:h,holderDistanceFromTop:this.$imageHolder.offset().top-this.settings.windowObject.scrollTop()}},_bindEvents:function(){this.settings.windowObject.on("resize",this.refresh),this.settings.parallax===!0&&this.settings.windowObject.on("scroll",this._onScroll)},_unBindEvents:function(){this.settings.windowObject.off("resize",this.refresh),this.settings.parallax===!0&&this.settings.windowObject.off("scroll",this._onScroll)},_onScroll:function(){this.scrollingState.holderDistanceFromTop=this.$imageHolder.offset().top-this.settings.windowObject.scrollTop(),this._requestTick()},_requestTick:function(){var a=this;this.ticking||(this.ticking=!0,requestAnimationFrame(function(){a._updatePositions()}))},_updatePositions:function(){if(this.scrollingState.holderDistanceFromTop<=this.scrollingState.winHeight&&this.scrollingState.holderDistanceFromTop>=-this.scrollingState.imgHolderHeight){var a=this.scrollingState.holderDistanceFromTop+this.scrollingState.imgHolderHeight,b=a/this.scrollingState.travelDistance,c=Math.round(this.scrollingState.fromY+this.scrollingState.imgScrollingDistance*(1-b)),d=this.settings.container.offset().left;this.$scrollerHolder.css(this._getCSSObject({transform:r,left:d,x:Math.ceil(this.scrollingState.imgLeftPos)+(""===q&&d>0?d:0),y:Math.round(this.scrollingState.holderDistanceFromTop),visibility:"visible"})),this.$scrollingElement.css(this._getCSSObject({transform:r,x:0,y:c,visibility:"visible"}))}else this.$scrollerHolder.css({visibility:"hidden"}),this.$scrollingElement.css({visibility:"hidden"});this.ticking=!1},_updateFallbackPositions:function(){this.$scrollerHolder.css({width:"100%"}),this.$scrollingElement.css({top:this.scrollingState.imgTopPos,left:this.scrollingState.imgLeftPos})},_getCSSObject:function(a){return"csstransforms3d"===q?a.transform="translate3d("+a.x+"px, "+a.y+"px, 0)":"csstransforms"===q?a.transform="translate("+a.x+"px, "+a.y+"px)":(a.top=a.y,a.left=a.x),a},enable:function(){this.settings.touch===!1&&(this._bindEvents(),this.refresh())},disable:function(){this.settings.touch===!1&&this._unBindEvents()},refresh:function(){this.settings.touch===!1&&(this._adjustImgHolderHeights(),this.settings.parallax===!0?this._requestTick():this._updateFallbackPositions())},destroy:function(){this.settings.touch===!1&&this._unBindEvents(),this.settings.touch===!0?(this.$imageHolder.removeAttr("style"),this.$scrollingElement.remove()):this.settings.parallax===!0?(this.$scrollerHolder.find("."+this.settings.imgClass).remove(),this.$imageHolder.css({visibility:"visible",height:"auto"}).html(this.$scrollerHolder.html()),this.$scrollerHolder.remove()):(this.$imageHolder.css({overflow:"auto"}).removeAttr("style"),this.$scrollingElement.remove()),this.$imageHolder.removeData()}}),a.fn[d]=function(c){return void 0===c||"object"==typeof c?this.each(function(){a.data(this,e)||a.data(this,e,new b(this,c))}):"string"==typeof c&&"_"!==c[0]&&"init"!==c?this.each(function(){var d=a.data(this,e);d instanceof b&&"function"==typeof d[c]&&d[c].apply(d,Array.prototype.slice.call(arguments,1))}):void 0},a.fn[d].defaults=b.defaults=c,a.fn[d].Plugin=b,b});